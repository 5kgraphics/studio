<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - Digital Products</title>
<style>
  body {
    font-family: Georgia, serif;
    background: #fff;
    max-width: 800px;
    margin: 40px auto;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 6px;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
    font-weight: normal;
    letter-spacing: 2px;
  }
  form {
    display: flex;
    flex-direction: column;
  }
  label {
    margin-top: 10px;
    font-weight: bold;
  }
  input[type=text],
  textarea,
  select {
    padding: 10px;
    font-size: 16px;
    border: 1px solid #888;
    border-radius: 4px;
    margin-top: 5px;
  }
  textarea {
    resize: vertical;
  }
  button {
    margin-top: 20px;
    padding: 12px;
    font-size: 18px;
    background: #444;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #222;
  }
  #msg {
    margin-top: 15px;
    color: green;
    font-weight: bold;
    text-align: center;
  }
  .product-list {
    margin-top: 30px;
  }
  .product-item {
    padding: 15px;
    border: 1px solid #eee;
    margin-bottom: 10px;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .product-actions button {
    margin: 0 0 0 10px;
    padding: 6px 12px;
    font-size: 14px;
  }
  .edit-btn {
    background: #4a6fa5;
  }
  .delete-btn {
    background: #c33;
  }
</style>
</head>
<body>

<h1>Admin Panel - Digital Products</h1>

<form id="admin-form">
  <input type="hidden" id="productId">
  
  <label for="fileName">File Name *</label>
  <input type="text" id="fileName" required />

  <label for="description">Description *</label>
  <textarea id="description" rows="3" required></textarea>

  <label for="imageUrl">Image URL *</label>
  <input type="text" id="imageUrl" placeholder="https://example.com/image.jpg" required />

  <label for="fileSize">File Size (e.g. 20MB) *</label>
  <input type="text" id="fileSize" required />

  <label for="downloadUrl">Download URL *</label>
  <input type="text" id="downloadUrl" placeholder="https://example.com/file.zip" required />

  <label for="category">Category *</label>
  <select id="category" required>
    <option value="" disabled selected>Select category</option>
    <option value="Ebook">Ebook</option>
    <option value="Software">Software</option>
    <option value="Audio">Audio</option>
    <option value="Video">Video</option>
    <option value="Other">Other</option>
  </select>

  <label for="extraInfo">Extra Info (optional)</label>
  <textarea id="extraInfo" rows="2" placeholder="Any additional info"></textarea>

  <button type="submit" id="submit-btn">Add Product</button>
  <button type="button" id="cancel-btn" style="display: none; background: #888;">Cancel</button>
</form>

<div id="msg"></div>

<div class="product-list" id="product-list">
  <h2>Existing Products</h2>
  <!-- Products will be listed here -->
</div>

<script>
  // Load existing products from localStorage
  function loadProducts() {
    return JSON.parse(localStorage.getItem('digitalProducts') || '[]');
  }

  // Save products to localStorage
  function saveProducts(products) {
    localStorage.setItem('digitalProducts', JSON.stringify(products));
    displayProducts();
    // Notify other tabs/pages to update
    localStorage.setItem('digitalProductsUpdate', Date.now());
  }

  // Display all products
  function displayProducts() {
    const products = loadProducts();
    const container = document.getElementById('product-list');
    
    // Clear existing products (except the heading)
    while (container.children.length > 1) {
      container.removeChild(container.lastChild);
    }

    if (products.length === 0) {
      container.innerHTML += '<p>No products found.</p>';
      return;
    }

    products.forEach((product, index) => {
      const div = document.createElement('div');
      div.className = 'product-item';
      div.innerHTML = `
        <div>
          <strong>${product.fileName}</strong> (${product.category})<br>
          <small>${product.description.substring(0, 50)}...</small>
        </div>
        <div class="product-actions">
          <button class="edit-btn" data-id="${index}">Edit</button>
          <button class="delete-btn" data-id="${index}">Delete</button>
        </div>
      `;
      container.appendChild(div);
    });

    // Add event listeners to new buttons
    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', editProduct);
    });
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', deleteProduct);
    });
  }

  // Edit product
  function editProduct(e) {
    const products = loadProducts();
    const productId = e.target.getAttribute('data-id');
    const product = products[productId];

    // Fill form with product data
    document.getElementById('productId').value = productId;
    document.getElementById('fileName').value = product.fileName;
    document.getElementById('description').value = product.description;
    document.getElementById('imageUrl').value = product.imageUrl;
    document.getElementById('fileSize').value = product.fileSize;
    document.getElementById('downloadUrl').value = product.downloadUrl;
    document.getElementById('category').value = product.category;
    document.getElementById('extraInfo').value = product.extraInfo || '';

    // Change button to "Update"
    document.getElementById('submit-btn').textContent = 'Update Product';
    document.getElementById('cancel-btn').style.display = 'inline-block';
  }

  // Delete product
  function deleteProduct(e) {
    if (!confirm('Are you sure you want to delete this product?')) return;
    
    const products = loadProducts();
    const productId = e.target.getAttribute('data-id');
    
    products.splice(productId, 1);
    saveProducts(products);
    
    document.getElementById('msg').style.color = 'green';
    document.getElementById('msg').textContent = 'Product deleted successfully!';
  }

  // Form submission
  const form = document.getElementById('admin-form');
  const msg = document.getElementById('msg');

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    // Get values
    const productId = document.getElementById('productId').value;
    const fileName = document.getElementById('fileName').value.trim();
    const description = document.getElementById('description').value.trim();
    const imageUrl = document.getElementById('imageUrl').value.trim();
    const fileSize = document.getElementById('fileSize').value.trim();
    const downloadUrl = document.getElementById('downloadUrl').value.trim();
    const category = document.getElementById('category').value;
    const extraInfo = document.getElementById('extraInfo').value.trim();

    // Validation
    if (!fileName || !description || !imageUrl || !fileSize || !downloadUrl || !category) {
      msg.style.color = 'red';
      msg.textContent = 'Please fill in all required fields.';
      return;
    }

    const products = loadProducts();
    const productData = {
      fileName,
      description,
      imageUrl,
      fileSize,
      downloadUrl,
      category,
      extraInfo
    };

    if (productId === '') {
      // Add new product
      products.push(productData);
      msg.textContent = 'Product added successfully!';
    } else {
      // Update existing product
      products[productId] = productData;
      msg.textContent = 'Product updated successfully!';
    }

    saveProducts(products);
    form.reset();
    document.getElementById('productId').value = '';
    document.getElementById('submit-btn').textContent = 'Add Product';
    document.getElementById('cancel-btn').style.display = 'none';
    msg.style.color = 'green';
  });

  // Cancel edit
  document.getElementById('cancel-btn').addEventListener('click', function() {
    form.reset();
    document.getElementById('productId').value = '';
    document.getElementById('submit-btn').textContent = 'Add Product';
    this.style.display = 'none';
    msg.textContent = '';
  });

  // Initial display
  displayProducts();
</script>

</body>
</html>